#!/usr/bin/env bash
# vim: ft=sh:

APP_NAME=$(basename $0)
APP_VERSION="1.0.0"
OPTION_ACTIVE_IS="6 month ago"

command_help()
{
	cat <<-EOT
	Will print the name of repositories which do not have commits for a given
	amount of time.

	Usage: $APP_NAME
	       $APP_NAME [-v | --version]
	       $APP_NAME [-h | --help]
	       $APP_NAME [-a <d> | --active <d]
	
	Options
	  -a <d>     Considers repository to be inactive if there are no commits
	             since that period (Default: $OPTION_ACTIVE_IS).

	Send bugs or suggestions to augusto.hp@gmail.com
	EOT
}

test ! -z "$DEBUG" && { set -x; }

while :;
do
	if [ $# = 0 ]
	then
		break
	fi

	case $1 in
		-h|--help)
			command_help
			exit 0
			;;
		-a|--active)
			OPTION_ACTIVE_IS="$2"
			shift
			;;
		-v|--version)
			echo "$APP_NAME $APP_VERSION"
			exit 0
			;;
		--)
			break
			;;
	esac
	shift
done

for git_path in $(for_every_dir_containing --pattern ".git" --command "pwd")
do
	repository="${git_path%%/.git}"
	pushd "$repository" > /dev/null
	commits=$(git log --since "$OPTION_ACTIVE_IS" --oneline | wc -l)
	if [ $commits -eq 0 ]
	then
		echo $repository
	fi
	popd > /dev/null
done
